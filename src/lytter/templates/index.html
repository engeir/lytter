{% extends "base.html" %}
{% from 'macros.html' import stat_card, loading_spinner %}

{% block title %}Dashboard - Last.fm Stats{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">Last.fm Statistics Dashboard</h1>
    </div>
</div>

{% if current_track %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">ðŸŽ§ Currently Playing</h5>
                <h6 class="card-subtitle mb-2 text-muted">{{ current_track.artist }}</h6>
                <p class="card-text">
                    <strong>{{ current_track.title }}</strong><br>
                    <small>from {{ current_track.album }}</small>
                </p>
                <a href="/artist/{{ current_track.artist|urlencode }}" class="btn btn-primary btn-sm">View Artist Stats</a>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row mb-4">
    <div class="col-md-3">
        {{ stat_card("Total Scrobbles", total_scrobbles) }}
    </div>
    <div class="col-md-3">
        {{ stat_card("Unique Artists", unique_artists) }}
    </div>
    <div class="col-md-3">
        {{ stat_card("Unique Tracks", unique_tracks) }}
    </div>
    <div class="col-md-3">
        {{ stat_card("Unique Albums", unique_albums) }}
    </div>
</div>

<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Listening Timeline</h5>
                <div id="timeline-chart" style="height: 400px;">
                    <div class="d-flex justify-content-center align-items-center h-100">
                        <p class="text-muted">Loading chart...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Recent Favorites</h5>
                <div hx-get="/html/recent-favorites" hx-trigger="load">
                    {{ loading_spinner("Loading favorites...") }}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Top Artists</h5>
                <div hx-get="/html/top-artists" hx-trigger="load">
                    {{ loading_spinner("Loading top artists...") }}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Load Plotly chart (only thing that needs custom JS)
if (typeof Plotly !== 'undefined') {
    fetch('/charts/listening-timeline')
        .then(response => response.json())
        .then(data => {
            Plotly.newPlot('timeline-chart', data.data, data.layout, {responsive: true});
        })
        .catch(error => {
            document.getElementById('timeline-chart').innerHTML = '<p class="text-muted">Error loading chart</p>';
        });
} else {
    document.getElementById('timeline-chart').innerHTML = '<p class="text-muted">Plotly.js failed to load</p>';
}
</script>
{% endblock %}
